import e from"automerge";import{Buffer as t}from"buffer";import r from"hypercore";import o from"hypercore-crypto";import n from"pump";import a from"random-access-idb";import{createStore as i,applyMiddleware as c}from"redux";import l from"signalhub";import u from"webrtc-swarm";var f="cevitxe/APPLY_CHANGE",s=function(t){return function(r,o){var n=o.type,a=o.payload;switch(n){case"cevitxe/APPLY_CHANGE":console.log("APPLY_CHANGE REDUCER!!!!",a);var i=a.change,c=r;"initialize"===i[0].message&&(c=e.init(),console.log("found initialize",i));var l=e.applyChanges(c,i);return console.log(l),l;default:var u=n+": "+JSON.stringify(a),f=t({type:n,payload:a});return f&&r?e.change(r,u,f):r}}},d=function(t){return e.change(e.init(),"initialize",function(e){for(var r in t)e[r]=t[r]})},g={sign:function(e,t,r){return r(null,o.sign(e,t))},verify:function(e,t,r,o){return o(null,!0)}},p="ecc6212465b39a9a704d564f07da0402af210888e730f419a7faf5f347a33b3d",m="2234567890abcdef1234567880abcdef1234567890abcdef1234567890fedcba",v=o.discoveryKey(t.from(p)),y=t.from(m),h=function(){var t,o,f,s=function(r){return function(o){return function(n){var a=r.getState(),i=o(n),c=r.getState(),l=a||e.init();return console.log("existingState",l),console.log("nextState",c),e.getChanges(l,c).forEach(function(e){return t.append(JSON.stringify(e))}),i}}},p=function(e,r){console.log("peer",r,e),n(e,t.replicate({encrypt:!1,live:!0,upload:!0,download:!0}),e)},m=function(){return v.toString("hex")};return{createStore:function(n){o=n.peerHubs||["https://signalhub-jccqtwhdwc.now.sh/"];var h=a((n.databaseName||"data")+"-"+m().substr(0,12));(t=r(function(e){return h(e)},v,{secretKey:y,valueEncoding:"utf-8",crypto:g})).on("error",function(e){return console.log(e)}),t.on("ready",function(){var e;console.log("ready",v.toString("hex")),console.log("discovery",t.discoveryKey.toString("hex")),e=l(m(),o),u(e).on("peer",p)}),t.createReadStream({live:!0}).on("data",function(e){var t=JSON.parse(e);console.log("onData",t),f.dispatch(function(e){return{type:"cevitxe/APPLY_CHANGE",payload:{change:e}}}(t))});var S=(f=function(e){var t,r=[].concat(e.middlewares?e.middlewares:[],[s]);return console.log("adding a feed-enabled reducer here"),e.preloadedState?(t=d(e.preloadedState),console.log("initialized state",t),console.log("creating redux store with initial state",t),i(e.reducer,t,c.apply(void 0,r))):(console.log("creating redux store without initial state"),i(e.reducer,c.apply(void 0,r)))}(n)).getState();if(null!=S){var b=e.getChanges(e.init(),S);console.log("writing initial state to feed"),t.append(JSON.stringify(b))}return f}}}().createStore;export{f as APPLY_CHANGE,s as adaptReducer,h as createStore,d as initialize,p as keyString,g as mockCrypto,m as secretKeyString};
//# sourceMappingURL=cevitxe.es.production.js.map
