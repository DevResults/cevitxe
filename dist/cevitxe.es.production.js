import e from"automerge";import{Buffer as r}from"buffer";import o from"hypercore";import t from"hypercore-crypto";import n from"pump";import a from"random-access-idb";import{createStore as i,applyMiddleware as c}from"redux";import l from"signalhub";import u from"webrtc-swarm";var f="cevitxe/APPLY_CHANGE",d=function(r){return function(o,t){var n=t.type,a=t.payload;switch(n){case"cevitxe/APPLY_CHANGE":console.log("APPLY_CHANGE REDUCER!!!!",a);var i=a.change,c=o;"initialize"===i.message&&(c=e.init(),console.log("found initialize",i));var l=e.applyChanges(c,[i]);return console.log(l),l;default:var u=n+": "+JSON.stringify(a),f=r({type:n,payload:a});return f&&o?e.change(o,u,f):o}}},s=function(r){return e.change(e.init(),"initialize",function(e){for(var o in r)e[o]=r[o]})},p={sign:function(e,r,o){return o(null,t.sign(e,r))},verify:function(e,r,o,t){return t(null,!0)}},g="ecc6212465b39a9a704d564f07da0402af210888e730f419a7faf5f347a33b3d",m="2234567890abcdef1234567880abcdef1234567890abcdef1234567890fedcba",v=t.discoveryKey(r.from(g)),y=r.from(m),h=function(){var r,t,f,d=function(o){return function(t){return function(n){var a=o.getState(),i=t(n);if(n.payload.fromCevitxe)return console.log("already from cevitxe, skipping the feed write"),i;var c=o.getState(),l=a||e.init();return console.log("existingState",l),console.log("nextState",c),e.getChanges(l,c).forEach(function(e){return r.append(JSON.stringify(e))}),i}}},g=function(e,o){console.log("peer",o,e),n(e,r.replicate({encrypt:!1,live:!0,upload:!0,download:!0}),e)},m=function(){return v.toString("hex")};return{createStore:function(e){t=e.peerHubs||["https://signalhub-jccqtwhdwc.now.sh/"];var n=a((e.databaseName||"data")+"-"+m().substr(0,12));return(r=o(function(e){return n(e)},v,{secretKey:y,valueEncoding:"utf-8",crypto:p})).on("error",function(e){return console.log(e)}),r.on("ready",function(){var e;console.log("ready",v.toString("hex")),console.log("discovery",r.discoveryKey.toString("hex")),e=l(m(),t),u(e).on("peer",g)}),r.createReadStream({live:!0}).on("data",function(e){var r=JSON.parse(e);console.log("onData",r),f.dispatch(function(e){return{type:"cevitxe/APPLY_CHANGE",payload:{change:e,fromCevitxe:!0}}}(r))}),f=function(e){var r,o=[].concat(e.middlewares?e.middlewares:[],[d]);return console.log("adding a feed-enabled reducer here"),e.preloadedState?(r=s(e.preloadedState),console.log("initialized state",r),console.log("creating redux store with initial state",r),i(e.reducer,r,c.apply(void 0,o))):(console.log("creating redux store without initial state"),i(e.reducer,c.apply(void 0,o)))}(e),console.log("todos",n),f}}}().createStore;export{f as APPLY_CHANGE,d as adaptReducer,h as createStore,s as initialize,g as keyString,p as mockCrypto,m as secretKeyString};
//# sourceMappingURL=cevitxe.es.production.js.map
