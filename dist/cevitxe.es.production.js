import e from"automerge";import{compose as r,createStore as n}from"redux";import{Buffer as o}from"buffer";import t from"hypercore";import a from"hypercore-crypto";import i from"pump";import c from"random-access-idb";import u from"signalhub";import l from"webrtc-swarm";var d="cevitxe/APPLY_CHANGE",f={applyChange:function(e){return{type:"cevitxe/APPLY_CHANGE",payload:{change:e}}}},s=function(r){return function(n,o){var t=o.type,a=o.payload;switch(t){case"cevitxe/APPLY_CHANGE":console.log("APPLY_CHANGE REDUCER!!!!",a);var i=e.applyChanges(n,[a.change]);return console.log(i),i;default:var c=t+": "+JSON.stringify(a),u=r({type:t,payload:a});return u&&n?e.change(n,c,u):n}}},p=function(){var e=[];return{enhancer:function(n){return function(o){return function(t){var a=e.map(function(e){return e(n)});return r.apply(void 0,a)(o)(t)}}},addMiddleware:function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];e=[].concat(e,n)},removeMiddleware:function(r){var n=e.findIndex(function(e){return e===r});-1!==n?e=e.filter(function(e,r){return r!==n}):console.error("Middleware does not exist!",r)},resetMiddlewares:function(){e=[]}}},v=p(),g=v.enhancer,y=v.addMiddleware,m=v.removeMiddleware,h=v.resetMiddlewares,w={sign:function(e,r,n){return n(null,a.sign(e,r))},verify:function(e,r,n,o){return o(null,!0)}},b=function(){var e,r,d,f,s=function(r,n){console.log("peer",n,r),i(r,e.replicate({encrypt:!1,live:!0,upload:!0,download:!0}),r)},p=function(){return r.toString("hex")};function v(e,r,o){var t,a;return void 0!==o?(a=r,t=o):t=r,console.log("add a feed-enabled reducer here"),void 0!==a?n(e,a,t):n(e,t)}return{createFeed:function(n){if(!n.key)throw new Error("Key is required, should be XXXX in length");if(r=a.discoveryKey(o.from(n.key)),!n.secretKey)throw new Error("Secret key is required, should be XXXX in length");d=o.from(n.secretKey),f=n.peerHubs||["https://signalhub-jccqtwhdwc.now.sh/"];var i=c((n.databaseName||"data")+"-"+p().substr(0,12));return(e=t(function(e){return i(e)},r,{secretKey:d,valueEncoding:"utf-8",crypto:w})).on("error",function(e){return console.log(e)}),e.on("ready",function(){var n;console.log("ready",r.toString("hex")),console.log("discovery",e.discoveryKey.toString("hex")),n=u(p(),f),l(n).on("peer",s)}),e.createReadStream({live:!0}).on("data",function(e){try{var r=JSON.parse(e);console.log("onData",r)}catch(r){console.log("feed read error",r),console.log("feed stream returned an unknown value",e)}}),{createStore:v}}}}().createFeed,S=function(r){return e.change(e.init(),"initialize",function(e){for(var n in r)e[n]=r[n]})},x=function(r){var n=localStorage.getItem(r);return n?e.load(n):null},A=function(r,n){var o=e.save(n);localStorage.setItem(r,o)},E=function(e){var r=e.key;return function(e){return function(n){return function(o){var t=n(o),a=e.getState();return A(r,a),t}}}};export{d as APPLY_CHANGE,f as actions,s as adaptReducer,y as addMiddleware,g as cevitxeMiddleware,p as createDynamicMiddlewares,b as createFeed,S as initialize,x as load,E as middleware,w as mockCrypto,m as removeMiddleware,h as resetMiddlewares,A as save};
//# sourceMappingURL=cevitxe.es.production.js.map
